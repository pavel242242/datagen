{
  "version": "1.0",
  "metadata": {
    "name": "SaaS Analytics Platform - User Engagement Lifecycle",
    "description": "Feature #4: PostHog/HubSpot/Amplitude style user engagement tracking. Models evaluation → onboarded → power_user → dormant → churned lifecycle with product-led growth patterns."
  },
  "timeframe": {
    "start": "2024-01-01T00:00:00Z",
    "end": "2024-12-31T23:59:59Z",
    "freq": "H"
  },
  "constraints": {
    "foreign_keys": [
      {"from": "user_engagement.user_id", "to": "analytics_user.user_id"}
    ]
  },
  "nodes": [
    {
      "id": "analytics_user",
      "kind": "entity",
      "pk": "user_id",
      "rows": 1000,
      "segment_behavior": {
        "segment_column": "signup_source",
        "segments": {
          "product_led": {"base_probability": 0.60},
          "sales_led": {"base_probability": 0.25},
          "partner": {"base_probability": 0.15}
        }
      },
      "columns": [
        {
          "name": "user_id",
          "type": "int",
          "generator": {"sequence": {"start": 10000, "step": 1}}
        },
        {
          "name": "email",
          "type": "string",
          "generator": {"faker": {"method": "email"}}
        },
        {
          "name": "company_name",
          "type": "string",
          "generator": {"faker": {"method": "company"}}
        },
        {
          "name": "signup_source",
          "type": "string",
          "generator": {
            "choice": {
              "choices": ["product_led", "sales_led", "partner"],
              "weights": [0.60, 0.25, 0.15]
            }
          }
        },
        {
          "name": "company_size",
          "type": "string",
          "generator": {
            "choice": {
              "choices": ["1-10", "11-50", "51-200", "201-1000", "1000+"],
              "weights": [0.40, 0.30, 0.15, 0.10, 0.05]
            }
          }
        },
        {
          "name": "signup_date",
          "type": "datetime",
          "generator": {
            "datetime_series": {
              "within": {
                "start": "2024-01-01T00:00:00Z",
                "end": "2024-12-31T23:59:59Z"
              },
              "freq": "H",
              "pattern": {
                "dimension": "dow",
                "weights": [0.8, 1.1, 1.2, 1.1, 1.0, 0.7, 0.6]
              }
            }
          }
        },
        {
          "name": "country",
          "type": "string",
          "generator": {
            "choice": {
              "choices": ["US", "UK", "DE", "FR", "CA", "AU", "NL", "SG"],
              "weights": [0.40, 0.15, 0.10, 0.08, 0.10, 0.07, 0.05, 0.05]
            }
          }
        }
      ]
    },
    {
      "id": "user_engagement",
      "kind": "fact",
      "pk": "engagement_id",
      "parents": ["analytics_user"],
      "state_transition_model": {
        "initial_state": "evaluation",
        "states": {
          "evaluation": {
            "transition_prob_per_period": 0.85,
            "next_states": {
              "onboarded": 0.40,
              "dormant": 0.35,
              "churned": 0.25
            }
          },
          "onboarded": {
            "transition_prob_per_period": 0.25,
            "next_states": {
              "power_user": 0.25,
              "active": 0.50,
              "dormant": 0.25
            }
          },
          "active": {
            "transition_prob_per_period": 0.12,
            "next_states": {
              "power_user": 0.30,
              "dormant": 0.50,
              "churned": 0.20
            }
          },
          "power_user": {
            "transition_prob_per_period": 0.05,
            "next_states": {
              "active": 0.70,
              "dormant": 0.25,
              "churned": 0.05
            }
          },
          "dormant": {
            "transition_prob_per_period": 0.40,
            "next_states": {
              "active": 0.30,
              "churned": 0.70
            }
          },
          "churned": {
            "transition_prob_per_period": 0.03,
            "next_states": {
              "evaluation": 1.0
            }
          }
        },
        "period_unit": "week",
        "max_transitions": 30,
        "segment_variation": {
          "product_led": {"churn_multiplier": 1.3},
          "sales_led": {"churn_multiplier": 0.6},
          "partner": {"churn_multiplier": 0.8}
        },
        "vintage_variation": {
          "churn_multiplier_curve": [1.2, 1.0, 0.85, 0.75, 0.65, 0.60, 0.55, 0.50, 0.45, 0.40]
        }
      },
      "columns": [
        {
          "name": "engagement_id",
          "type": "int",
          "generator": {"sequence": {"start": 1, "step": 1}}
        },
        {
          "name": "user_id",
          "type": "int",
          "generator": {"lookup": {"from": "analytics_user.user_id"}}
        },
        {
          "name": "engagement_state",
          "type": "string",
          "generator": {"choice": {"choices": ["evaluation"]}}
        },
        {
          "name": "previous_engagement_state",
          "type": "string",
          "nullable": true,
          "generator": {"choice": {"choices": [""]}}
        },
        {
          "name": "state_changed_at",
          "type": "datetime",
          "generator": {
            "datetime_series": {
              "within": {
                "start": "2024-01-01T00:00:00Z",
                "end": "2024-12-31T23:59:59Z"
              },
              "freq": "H"
            }
          }
        },
        {
          "name": "weekly_active_days",
          "type": "int",
          "generator": {
            "distribution": {
              "type": "poisson",
              "params": {"lam": 3.5},
              "clamp": [0, 7]
            }
          }
        }
      ]
    }
  ]
}
